<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>学生界面</title>
  <!-- 请勿在项目正式环境中引用该 layui.css 地址 -->
  <!-- <link href="//unpkg.com/layui@2.9.13/dist/css/layui.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="layui/css/layui.css">
</head>
<body>
<div class="layui-layout layui-layout-admin">
  <div class="layui-header">
    <div class="layui-logo">学生界面</div>
    <!-- 头部区域（可配合layui已有的水平导航） -->
    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item">
        <a href="javascript:;">
          <img src="/computer manager/img/1.png" class="layui-nav-img" id="user-avatar">
          <span id="username">null</span>
        </a>
        <dl class="layui-nav-child">
          <dd><a href="">基本资料</a></dd>
          <dd><a href="">安全设置</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item"><a href="AdminLogin.html">退出</a></li>
    </ul>
  </div>
  
  <div class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
      <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
      <ul class="layui-nav layui-nav-tree" lay-filter="admin-nav">
        <li class="layui-nav-item">
          <a href="javascript:;" id="home-link">首页</a>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">申请机器</a>
        </li>
      </ul>
    </div>
  </div>
  
  <div class="layui-body">
    <!-- 内容主体区域 -->
    <div id="content" style="padding: 15px;"></div>
  </div>
  
  <div class="layui-footer">
    <!-- 底部固定区域 -->
    ©  - 底部固定区域
  </div>
</div>

<!-- 请勿在项目正式环境中引用该 layui.js 地址 -->
<!-- <script src="//unpkg.com/layui@2.9.13/dist/layui.js"></script> -->
<script src="layui/layui.js"></script>
<script>
layui.use(['element', 'table', 'laypage', 'layer'], function(){
    var element = layui.element;
    var table = layui.table;
    var laypage = layui.laypage;
    var layer = layui.layer;
  
  // 一些事件监听
  element.on('nav(admin-nav)', function(elem){
    // 获取点击的菜单项的文本
    var menuItem = elem.text().trim();
    
    // 根据菜单项的文本加载不同的内容
    switch(menuItem) {
      case '首页':
        loadHomePage();
        break;
      case '申请机器':
        loadMachineInfoPage();
        break;
      default:
        loadHomePage();
    }
  });
  // 加载首页内容
    function loadHomePage() {
    document.getElementById('content').innerHTML = `
        <span id="ues"><h1>您目前申请使用的机器如下：</h1></span>
        <table class="layui-table" id="machine-table"></table>
        <div id="pagination"></div>
    `;
    fetchMachineInfo();
    }

    // 加载申请机器内容
    function loadMachineInfoPage() {
    document.getElementById('content').innerHTML = `
        <h1>机器信息管理</h1><p>这里是机器信息管理内容</p>
    `;
    }
});
document.addEventListener('DOMContentLoaded', async function() {
  var token = localStorage.getItem('token');
  
  if (!token) {
    // 如果没有token，重定向到登录页面
    window.location.href = 'StudentLogin.html';
    return;
  }

  try {
    // 第一个请求
    let response = await fetch('http://localhost:8080/student/getStuInfo', {
      method: 'GET',
      headers: {
        'token': token,
        'Content-Type': 'application/json'
      }
    });

    let studentInfo = await response.json();

    if (studentInfo.code === 200) {
        // 更新用户名
        document.getElementById('username').textContent = studentInfo.data.loginStu.studentName;
    } else {
        window.location.href = 'StudentLogin.html';
    }

    // 发送第二个请求，携带第一个请求返回的数据
    response = await fetch('http://localhost:8080/student/useMachineInfo', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        studentId: studentInfo.data.loginStu.studentId,
        studentNumber: studentInfo.data.loginStu.studentNumber,
        studentEmail: studentInfo.data.loginStu.studentEmail,
        studentName: studentInfo.data.loginStu.studentName,
      })
    });

    let otherInfo = await response.json();
    // 处理第二个请求的响应数据
    console.log(otherInfo);
    if (otherInfo.code === 200) {
        console.log(otherInfo);
        console.log(studentInfo);
    }

    

  } catch(error) {
    console.error(error);
    // 处理错误，重定向到登录页面
    window.location.href = 'StudentLogin.html';
  }
document.getElementById('home-link').click();
});
</script>
</body>
</html>
