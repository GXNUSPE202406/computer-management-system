<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>管理员界面</title>
  <!-- 请勿在项目正式环境中引用该 layui.css 地址 -->
  <!-- <link href="//unpkg.com/layui@2.9.13/dist/css/layui.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="layui/css/layui.css">
</head>
<body>
<div class="layui-layout layui-layout-admin">
  <div class="layui-header">
    <div class="layui-logo">管理员界面</div>
    <!-- 头部区域（可配合layui已有的水平导航） -->
    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item">
        <a href="javascript:;">
          <img src="/computer manager/img/1.png" class="layui-nav-img">
          管理员
        </a>
        <dl class="layui-nav-child">
          <dd><a href="">基本资料</a></dd>
          <dd><a href="">安全设置</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item"><a href="AdminLogin.html">退出</a></li>
    </ul>
  </div>
  
  <div class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
      <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
      <ul class="layui-nav layui-nav-tree" lay-filter="admin-nav">
        <li class="layui-nav-item">
          <a href="AdminInterface.html">首页</a>
        </li>
        <li class="layui-nav-item">
          <a href="RoomManage.html">机器信息管理</a>
        </li>
        <li class="layui-nav-item">
          <a href="ComputerInfo.html">机房信息统计</a>
        </li>
      </ul>
    </div>
  </div>
  
  <div class="layui-body">
    <!-- 内容主体区域 -->
    <div style="padding: 15px;">
      <!-- 表格内容开始 -->
      <div style="padding: 16px;"> 
        <table class="layui-hide" id="test" lay-filter="test"></table>
      </div>
      <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
          <button class="layui-btn layui-btn-radius" id="addButton">
            添加
          </button>
        </div>
      </script>
      <script type="text/html" id="barDemo">
        <!-- <div class="layui-clear-space">
          <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
          <a class="layui-btn layui-btn-xs" lay-event="more">
            更多 
            <i class="layui-icon layui-icon-down"></i>
          </a>
        </div> -->
        <div class="layui-btn-group">
        
          <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" lay-event="edit">编辑</button>
        
          <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" lay-event="del">删除</button>
        
        </div>

      </script>  
      <!-- <script src="//cdn.staticfile.net/layui/2.9.13/layui.js"></script> -->
      <script src="layui/layui.js"></script>
      <script>
      layui.use(['table', 'dropdown', 'form'], function(){
        var table = layui.table;
        var dropdown = layui.dropdown;
        var form = layui.form;
        var machineIdCounter = 1000; // 初始化机器编号计数器
        // 获取URL中的roomId参数
        var urlParams = new URLSearchParams(window.location.search);
        var roomId = urlParams.get('roomId');
        
        // 创建渲染实例
        table.render({
          elem: '#test',
          url: 'http://localhost:8080/adminPortal/findRoomMachines/' + roomId, // 此处为静态模拟数据，实际使用时需换成真实接口
          toolbar: '#toolbarDemo',
          defaultToolbar: ['filter', 'exports', 'print', { // 右上角工具图标
            title: '提示',
            layEvent: 'LAYTABLE_TIPS',
            icon: 'layui-icon-tips',
            onClick: function(obj) { // 2.9.12+
              layer.alert('机器信息表格');
            }
          }],
          height: 'full-35', // 最大高度减去其他容器已占有的高度差
          css: [ // 重设当前表格样式
            '.layui-table-tool-temp{padding-right: 145px;}'
          ].join(''),
          cellMinWidth: 80,
          page: true,
          parseData: function(res) { // 将返回的数据解析成 table 组件所需的数据
          return {
            "code": res.code === 200 ? 0 : res.code, // 将 code 200 转换成 0
            "msg": res.message, // 将 message 字段赋值给 msg
            "count": res.data.count, // 总记录数
            "data": res.data.data // 数据列表
          };
        },
          cols: [[
            {type: 'checkbox', fixed: 'left'},
            {title: '序号', type: 'numbers', fixed: 'left', width: 60}, // 序号列
            {field:'screenModel', width:150, title: '显示器'},
            {field:'cpuModel', width:150, title: 'CPU'},
            {field:'gpuModel', width:150, title: '显卡'},
            {field:'roomId', width:150, title: '机房名称'},
            {field:'costPerHour', width:100, title: '单价/h', sort: true},
            {fixed: 'right', title:'操作', width:134, minWidth:15, toolbar: '#barDemo'}
          ]],
          done: function(){
            // 添加按钮点击事件

            document.getElementById('addButton').addEventListener('click', function(){
              layer.open({
                title: '添加',
                type: 1,
                area: ['80%', '80%'],
                content: `
                  <form class="layui-form" style="padding: 16px;">
                    <div class="layui-form-item">
                      <label class="layui-form-label">显示器</label>
                      <div class="layui-input-block">
                        <input type="text" name="display" required lay-verify="required" placeholder="请输入显示器信息" autocomplete="off" class="layui-input">
                      </div>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">CPU</label>
                      <div class="layui-input-block">
                        <input type="text" name="cpu" required lay-verify="required" placeholder="请输入CPU信息" autocomplete="off" class="layui-input">
                      </div>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">显卡</label>
                      <div class="layui-input-block">
                        <input type="text" name="gpu" required lay-verify="required" placeholder="请输入显卡信息" autocomplete="off" class="layui-input">
                      </div>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">机房名称</label>
                      <div class="layui-input-block">
                        <input type="text" name="room_name" required lay-verify="required" placeholder="请输入机房名称" autocomplete="off" class="layui-input">
                      </div>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">单价/h</label>
                      <div class="layui-input-block">
                        <input type="number" name="price_per_hour" required lay-verify="required" placeholder="请输入单价/h" autocomplete="off" class="layui-input">
                      </div>
                    </div>
                    <div class="layui-form-item">
                      <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="formAdd">确认</button>
                        <button type="button" class="layui-btn layui-btn-primary" id="cancelButton">取消</button>
                      </div>
                    </div>
                  </form>
                `,
                success: function(layero, index){
                  // 取消按钮点击事件
                  document.getElementById('cancelButton').addEventListener('click', function(){
                    layer.close(index);
                  });

                  // 确认按钮（表单提交）事件
                  form.on('submit(formAdd)', function(data){
                    data.field.machine_id = machineIdCounter++; // 自动生成机器编号
                    console.log(data.field); // 当前表单数据
                    table.reload('test'); // 重新渲染表格
                    layer.close(index); // 关闭弹出层
                    return false; // 阻止表单跳转。如果需要表单跳转，去掉这段即可。
                  });
                }
              });
            });
          },
          error: function(res, msg){
            console.log(res, msg)
          }
        });
        
        // 表头自定义元素工具事件 --- 2.8.8+
        table.on('colTool(test)', function(obj){
          var event = obj.event;
          console.log(obj);
          if(event === 'email-tips'){
            layer.alert(layui.util.escape(JSON.stringify(obj.col)), {
              title: '当前列属性配置项'
            });
          }
        });
        
        // 触发单元格工具事件
        table.on('tool(test)', function(obj){ // 双击 toolDouble
          var data = obj.data; // 获得当前行数据
          // console.log(obj)
          if(obj.event === 'edit'){
            layer.open({
              title: '编辑',
              type: 1,
              area: ['80%','80%'],
              content: `
                <form class="layui-form" style="padding: 16px;">
                  <div class="layui-form-item">
                    <label class="layui-form-label">显示器</label>
                    <div class="layui-input-block">
                      <input type="text" name="display" required lay-verify="required" value="${data.display}" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">CPU</label>
                    <div class="layui-input-block">
                      <input type="text" name="cpu" required lay-verify="required" value="${data.cpu}" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">显卡</label>
                    <div class="layui-input-block">
                      <input type="text" name="gpu" required lay-verify="required" value="${data.gpu}" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">机房名称</label>
                    <div class="layui-input-block">
                      <input type="text" name="room_name" required lay-verify="required" value="${data.room_name}" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">单价/h</label>
                    <div class="layui-input-block">
                      <input type="number" name="price_per_hour" required lay-verify="required" value="${data.price_per_hour}" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <div class="layui-input-block">
                      <button class="layui-btn" lay-submit lay-filter="formEdit">确认</button>
                      <button type="button" class="layui-btn layui-btn-primary" id="cancelButton">取消</button>
                    </div>
                  </div>
                </form>
              `,
              success: function(layero, index){
                // 取消按钮点击事件
                document.getElementById('cancelButton').addEventListener('click', function(){
                  layer.close(index);
                });

                // 确认按钮（表单提交）事件
                form.on('submit(formEdit)', function(formdata){
                  // 更新表格数据
                  obj.update(formdata.field);
                  layer.close(index); // 关闭弹出层
                  return false; // 阻止表单跳转。如果需要表单跳转，去掉这段即可。
                });
              }
            });
          } else if(obj.event === 'del'){

            layer.confirm('真的要删除吗？', {icon: 3}, function(){

            layer.msg('删除成功', {icon: 1});
              

            }, function(){

            layer.msg('删除失败');

            });
          }
        });

        })
       
        // 触发表格复选框选择
        table.on('checkbox(test)', function(obj){
          console.log(obj)
        });
       
        // 触发表格单选框选择
        table.on('radio(test)', function(obj){
          console.log(obj)
        });
        
        // 行单击事件
        table.on('row(test)', function(obj){
          //console.log(obj);
          //layer.closeAll('tips');
        });
        // 行双击事件
        table.on('rowDouble(test)', function(obj){
          console.log(obj);
        });
       
        // 单元格编辑事件
        table.on('edit(test)', function(obj){
          var field = obj.field; // 得到字段
          var value = obj.value; // 得到修改后的值
          var data = obj.data; // 得到所在行所有键值
          // 值的校验
 
          // 编辑后续操作，如提交更新请求，以完成真实的数据更新
          // …
          layer.msg('编辑成功', {icon: 1});
          
          // 其他更新操作
          var update = {};
          update[field] = value;
          obj.update(update);
        });

      </script>
      <!-- 表格内容结束 -->
    </div>
  </div>
  

</div>

<!-- 请勿在项目正式环境中引用该 layui.js 地址 -->
<!-- <script src="//unpkg.com/layui@2.9.13/dist/layui.js"></script> -->
<script src="layui/layui.js"></script>
<script>
layui.use('element', function(){
  var element = layui.element;
  
  //一些事件监听
  element.on('nav(admin-nav)', function(elem){
    console.log(elem)
    
  });
});
</script>
</body>
</html>
